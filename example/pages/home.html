<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <base href="{{base}}" />
  <script type="text/javascript">
    "{{init}}"
  </script>
  <link href="shared/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
  <link href="shared/style.css" rel="stylesheet" />
  <script src="shared/jquery/jquery-3.4.1.slim.min.js"></script>
  <script src="shared/popper.js/popper.min.js"></script>
  <script src="shared/bootstrap/js/bootstrap.min.js"></script>
  <title>Sample Page</title>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-light fixed-top bd-navbar">
    <h1 class="navbar-brand">
      Workflow and Validation example using vscode-page.
    </h1>
  </nav>
  <div class="container-fluid" style="margin-top:63px;">
    <div class="row  flex-xl-nowrap">
      <div class="col-md-3 col-xl-2 bd-sidebar no-padding">
        <div class="bd-search d-flex py-md-3 pb-md-3">
        </div>
        <ul id="users" class="py-md-3 sidebar-sticky"></ul>
        <button type="button" class="btn btn-secondary" id="addUserBtn" onclick="showAddUserPage1()">
          Add User
        </button>
      </div>
      <main class="col-md-9 col-xl-10 py-md-3 pl-md-4 pr-md-4 bd-content">
        <h2 id="title"></h2>
        <hr />
        <div id="content"></div>
      </main>
    </div>
  </div>
  <script type="text/javascript">
    initEventListener();

    const vscode = acquireVsCodeApi();
    const wizardMap = new Map();
    init();

    function showAddUserPage1() {
      postCommandWithMap("showAddUserPage1");
    }

    function setPage1FieldsInMap() {
      var name1 = document.getElementById("addusername").value;
      var age1 = document.getElementById("adduserage").value;
      var country1 = document.getElementById("addusercountry").value;
      wizardMap.set('name', name1);
      wizardMap.set('age', age1);
      wizardMap.set('country', country1);
    }
    function validateAddUserPage1() {
      setPage1FieldsInMap();
      console.log("validate add user page 1:  ");
      console.log([...wizardMap.entries()]);
      postCommandWithMap("validateAddUserPage1");
    }

    function validateCreditCardNumber() {
      var ccnum1 = document.getElementById("ccnumber").value;
      wizardMap.set('ccnum',ccnum1);

      postCommandWithMap("validateCreditCardNumber");
    }

    function validateFavoriteColor() {
      var favcolor1 = document.getElementById("favcolor").value;
      wizardMap.set('favcolor',favcolor1);
      // do nothing
    }
    

    function showAddUserPage2() {
      setPage1FieldsInMap();
      postCommandWithMap("showAddUserPage2");
    }

    function submitAddUser() {
      console.log(document.getElementById("ccnumber"));
      console.log( document.getElementById("favcolor"));
      var ccnumElement = document.getElementById("ccnumber");
      var favcolorElement = document.getElementById("favcolor");
      var ccnum = (ccnumElement == null ? null : ccnumElement.value);
      var favcolor = (favcolorElement == null ? null : favcolorElement.value);
      wizardMap.set('ccnum', ccnum);
      wizardMap.set('favcolor', favcolor);
      postCommandWithMap("submitAddUser");
    }

    function showUser(userid) {
      vscode.postMessage({
        command: "showUser",
        parameters: {
          userid: userid
        } 
      });
    }

    function postCommandWithMap(cmdid) {
      console.log("Post command with map: ");
      console.log([...wizardMap.entries()]);
      vscode.postMessage({
        command: cmdid,
        parameters: Object.fromEntries(wizardMap)
      });
    }
    function init() {
      postCommandWithMap("ready");
    }

    function cancelSetting() {
      init();
    }
  </script>
</body>

</html>